## ケース1: ECサイト

ECサイトを利用する最も典型的なパターンを考えてみましょう。

### 登場人物

#### ユーザ A
商品を購入する人。

#### ECサイト
商品を販売している人。
トークン発行権のscopeを持つ

#### 配送業者 X
商品を配達する人。
Read権のscopeを持つ。

### シーケンス

- `ユーザ` は `ECサイト` にユーザ登録します。
  その際、当システムにOAuth認証し、永続的な住所トークン発行権を取得します。

- `ユーザ` は商品を購入します。
  `ECサイト` は住所トークン発行権を使い、 `配送業者 X` のみが読み取れる `ユーザ A` の住所トークンを発行します。

- `ECサイト` は `配送業者 X` に対して住所トークンを使い配送を依頼します。

- `配送業者 X` は住所トークンと発行者 `ECサイト` を当システムに問い合わせ、実住所を手に入れ配送します。

### 懸念点

この方式だと、ECサイトは住所トークンを発行し放題になります。
発行されても不正に使われなければ良いので、永続的な住所トークン発行権で作られた住所トークンには **発行者** を明示的に持つようにし、発行者と配送依頼者が同一でなければ実住所を参照できない仕組みにすれば良さそうです。

ただし、ECサイト自身が不正にトークンを利用し、例えば送りつけ詐欺などをすることを防ぐことはできません。
